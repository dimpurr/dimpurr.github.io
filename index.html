<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> NOTED DIM'ENSIONS</title><meta name="description" content="Know thyself / 汝自身を知れ / γνῶθι σεαυτόν"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><script src="//unpkg.com/valine/dist/Valine.min.js"></script><link rel="search" type="application/opensearchdescription+xml" href="http://note.dim.moe/atom.xml" title="NOTED DIM'ENSIONS"><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="NOTED DIM'ENSIONS" type="application/atom+xml">
</head><body><div class="wrap"><header><ul class="nav nav-list"><li class="nav-list-item"><b><a href="/" target="_self" class="nav-list-link active">NOTED DIM'ENSIONS</a></b></li><li class="nav-list-item"><b><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></b></li><li class="nav-list-item"><b><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></b></li></ul><ul class="nav nav-list"><li class="nav-list-item"><a href="http://blog.dimpurr.com/" target="_blank" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="https://blog.dim.moe/" target="_blank" class="nav-list-link">BLOG.MOE</a></li><li class="nav-list-item"><a href="http://book.dimpurr.com/" target="_blank" class="nav-list-link">BOOK</a></li><li class="nav-list-item"><a href="http://book.dim.moe/" target="_blank" class="nav-list-link">BOOK.MOE</a></li><li class="nav-list-item"><a href="http://note.dimpurr.com/" target="_blank" class="nav-list-link">KNOWLEDGE BASE</a></li></ul></header><main class="container"><ul class="home post-list"><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/macos-pve/" class="post-title-link">0202 年，在单分区 Proxmox 中安装 macOS Catalina (Hackintosh) 并直通硬件实现多系统</a></h2><div class="post-info">Jun 23, 2020</div><div class="post-content"><p>促使我现在坐在这里生无可恋并心如死灰的撰写这篇文章的唯一原因，是我又手贱炸掉了 Proxmox 的 grub 引导。在如此接近胜利的黎明曙光，以至于我都用 GeekBench 在虚拟的 Hackintosh macOS 中都已经跑完了 CPU 多核和 GPU 直通的分数之后，就在我正愉快的准备修好 iService 以便享受 Apple Store 时，一次小小的崩溃和重启，配合遭天杀的 os-prober ，一切努力变成了屏幕上白花花的 GRUB &gt; 。</p>
<p>人不作死，就不会死。</p>
<h2 id="前戏"><a href="#前戏" class="headerlink" title="前戏"></a>前戏</h2><p>今晚恰好是 WWDC 的发布会，变得更像 iPadOS 的 ARM 版 macOS 的发布似乎正提前宣告着 AMD Mac 末日以及 Hackintosh 的死刑。尽管 Telegram 上难得的又一次几乎每个群都在因为同一个话题而热火朝天，而我却在因为 Sketch 和 MarginNote 和 OmniFocus 和 Logic X Pro 和下略的各种无关紧要的独占 App 开始严重的怀念起 macOS ，并决定把 Hackintosh 付诸实践以对得起当初下决心买 Radeon VII 并含泪折腾 ROCm 的日日夜夜。当我辛辛苦苦完成了 OpenCore 的 Gathering Files 并用 ProperTree 调教好了 config.plist ，瑟瑟发抖并战战兢兢的尝试从安装盘启动的时候，满怀期待的我看到了一行 ……</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvme: Fatal error occurred</span><br></pre></td></tr></table></figure>

<p>接下来的对话是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; NVMEFix有了吗</span><br><span class="line">- 有啊</span><br><span class="line">&gt; 忘了一件很重要的事 中途C2000Pro换成了Intel Intel不行 装MX500？</span><br><span class="line">- 不是 我这 我难道得把 intel 拔掉？</span><br><span class="line">&gt; 不，屏蔽掉</span><br><span class="line">- 。。。那我的 macos 永远不能访问这个 intel ssd ？</span><br><span class="line">&gt; 不能</span><br><span class="line">- 东西都在里边诶。。。 我现在换一块硬盘来得及吗（</span><br><span class="line">&gt; 你可以换sn750 2t，不过一块要3000+</span><br><span class="line">- 我这块多少钱来着。。</span><br><span class="line">&gt; 1700好像</span><br><span class="line">- 啥原理，死刑？么有什么 patch ？</span><br><span class="line">&gt; 死刑 Intel家的基本都不行 mac pro那个群有阵子提到过</span><br></pre></td></tr></table></figure>

<p>是的，我想起来了， P4510 不被 macOS 原生支持 …… 虽然我还有一块 1TB 的 Curcial MX550 SSD 从空间上来说是足够的，但是显然我没法接受在使用 macOS 的时候完全无法访问另外 2TB 的常用数据，更不要说这块硬盘中间有 512GB 的未使用分区已经为 macOS 预留了很久很久了。于是，诞生了一个非常奇葩的解决方案：</p>
<p>在这个分区安装 debian 。然后把 debian 升级成 Proxmox 。然后，在里面创建一个占满全盘（当然，还有全部内存）的 Hackintosh 虚拟机。然后，再依次进行各种硬件的直通。</p>
<p>那么下文的记录献给和我一样在错误的时间（指发布 ARM macOS 的 WWDC 深夜）用奇怪的组合（指单分区 debian 升级 Proxmox）进行迷惑操作（指在双 AMD 平台进行 OpenCore 硬件直通 Hackintosh）的你。</p></div><a href="/macos-pve/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/rocm-ubuntu/" class="post-title-link">部署 ROCm 和 tensorflow-rocm 到 Ubuntu 18.04 (Radeon VII)</a></h2><div class="post-info">Apr 22, 2020</div><div class="post-content"><p>ROCm 实在是太多坑了 …… 用剩下的最后一口气吐槽+写文记录。晒一张最终跑分：</p>
<img src="/rocm-ubuntu/200422-gpu-benchmark.png" class="" title="200422-gpu-benchmark">

<h3 id="前因"><a href="#前因" class="headerlink" title="前因"></a>前因</h3><p>（这些都是废话，技术目的阅读请直接跳过）</p>
<p>因为一开始就计划要 Hackintosh 然后给 itx (机器名 madoka) 选装了 Radeon VII 。 HIS 公版，方方铁盒子信仰小红灯外加三个风扇，看起来就很生猛。这个价位可以买到的性价比最高的算力。更重要的是 macOS 可以免驱直插。 Mac Pro 同款。 7nm 制程（并没有什么卵用）， 16GB 显存富得流油（相对真正的实力来说根本不算什么）。隔壁 NIVIDA ，就算是 MacBook 官方提供的型号，更新 Mojave 之后一样驱动凉凉， N 卡用户没人权。再说我也没什么游戏需求， 3DMark 跑分看起来也七七八八，除了不限制电压的话风扇火力全开 4k rpm 噪音直接航天飞机起飞，其他一切都看起来很完美。</p>
<p>……直到我想搞深度学习（暴露了这家伙以前都没好好跑过几个网络的事实）。</p>
<p>人类回想起了被老黄 CUDA 统治的恐惧和你 AI 届 A 卡用户没人权的事实。 AMD 一点也不 Yes 。 ROCm 支持框架屈指可数，支持的还有一半在 in development ，完全不支持 Windows ，嗯 …… （科研人员：我们都是工费拨款，买来一块 Titan XP 插上就好了！</p>
<p>我烦恼了很久很久因为我真的很想一边跑 Tensorflow 一边开着 DAW 或者非编软件尤其是可爱的 Touch Designer 折腾可视化啊！事实已经证明了我的灵魂是媒体工作者，虽然我想搞 Deep Learning 但我很确信我大部分时间会拿现成网络倒腾倒腾跑应用，并且输入输出大概率全是媒体文件。不知道，其实我是瞎说的。所以我非常希望能够在本地跑，第一时间预览加调试，外加也许会有大量尺寸不小的数据集（比如自己整的动画或者一时兴起爬了个 exhentai ），实在不想必须提交云算力、或者把调试网络的系统环境与其他工作完全分开，每次想跑 AI 就必须停下手头全部其他事情然后重启进系统专注调参一发入魂 ……</p>
<p>以上这些毫无根据的执著以及自己钱太多的幻觉（信用卡警告）以至于此人花费超过半天时间研究雷蛇和技嘉的显卡盒以及DIY显卡核的可操作性和性能影响、发现itx上双显卡主板是完全不存在的伪需求、发现SLI双卡交火完全没什么意义更不要说A/N双卡打架以及自己的 MacBook Pro mid 2014 是雷电2会让外接速率雪上加霜。甚至还考虑相信 12 核 24 线程的 3900x 并使用 CPU 跑了一下 tensorflow benchmark ，结果 …… 速度是 VII 参考性能的 1/40 （ <a href="http://ai-benchmark.com/ranking_deeplearning.html" target="_blank" rel="noopener">http://ai-benchmark.com/ranking_deeplearning.html</a> &gt; Desktop GPUs and CPUs）。最后认真考虑了乖乖接受 NAS + wireguard 虚拟 NAT 使用云算力的方案之后，打算随便本地再开个系统装个 ROCm 跑通跑个分备用了事了。</p>
<p>然后， Elementary OS 拯救了我。它太美了。</p>
<p>（以下正文）</p>
<h3 id="ROCm-安装"><a href="#ROCm-安装" class="headerlink" title="ROCm 安装"></a>ROCm 安装</h3><p>官方文档：<a href="https://rocm-documentation.readthedocs.io/en/latest/Installation_Guide/Installation-Guide.html" target="_blank" rel="noopener">https://rocm-documentation.readthedocs.io/en/latest/Installation_Guide/Installation-Guide.html</a></p>
<p>这里是本机直接安装， ROCm 驱动并不会影响正常显示使用，如果是 docker 安装则需要屏蔽原有驱动并导致分辨率降低，若需要 docker 教程请另行寻找。</p>
<p>首先更新系统然后安装基础依赖：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt dist-upgrade</span><br><span class="line">sudo apt install libnuma-dev</span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure>

<p>重启了吗？然后添加 ROCm 的 ppa repo ：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget -q -O - http://repo.radeon.com/rocm/apt/debian/rocm.gpg.key | sudo apt-key add -</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'deb [arch=amd64] http://repo.radeon.com/rocm/apt/debian/ xenial main'</span> | sudo tee /etc/apt/sources.list.d/rocm.list</span><br></pre></td></tr></table></figure>

<p>这里有个很微妙的点，看到那里写的 <code>xenial</code> 了吗？千万不要像我一样自作聪明觉得可以改成 <code>bionic</code> 。这个 repo 里面根本没有 <code>bionic</code> 目录。至少现在还没有。</p>
<p>接下来更新源并安装：</p></div><a href="/rocm-ubuntu/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/hexo-pages/" class="post-title-link">部署 Hexo 博客到 Github Pages</a></h2><div class="post-info">Apr 11, 2020</div><div class="post-content"><p>Hexo 官方的文档地址：<a href="https://hexo.io/docs/github-pages.html" target="_blank" rel="noopener">https://hexo.io/docs/github-pages.html</a> 这个文档有一堆问题，评论区有提到。</p>
<p>建议使用 Travis CI 来部署。</p>
<h3 id="创建-Repo-和安装-Hexo"><a href="#创建-Repo-和安装-Hexo" class="headerlink" title="创建 Repo 和安装 Hexo"></a>创建 Repo 和安装 Hexo</h3><p>首先创建一个自己用户名的 repo <code>dimpurr.github.io</code> 。</p>
<p>随意要不要 Initialize ，然后把 Hexo 的文件丢进去。 <del><code>.gitignore</code> 可以选 Node 的，记得从里面去掉 <code>public</code> 一行的注释。</del> Hexo 自带 <code>.gitignore</code> 所以不用选。</p>
<p>如果和我一样还没有安装 Hexo 的话， clone repo 然后去新建 hexo 分支：</p></div><a href="/hexo-pages/" class="read-more">...more</a></article></li></ul></main><footer><div class="paginator"></div><div class="copyright"><p>© 2020 <a href="http://note.dim.moe">Dimpurr</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>