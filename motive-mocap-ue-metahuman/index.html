<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 将 OptiTrack Motive 导出的 FBX mocap 动作捕捉骨骼动画利用 IK (FK) Retargeting 重映射绑定到 Unreal Metahuman 上 · NOTED DIM'ENSIONS</title><meta name="description" content="将 OptiTrack Motive 导出的 FBX mocap 动作捕捉骨骼动画利用 IK (FK) Retargeting 重映射绑定到 Unreal Metahuman 上 - Dimpurr"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><script src="//unpkg.com/valine/dist/Valine.min.js"></script><link rel="search" type="application/opensearchdescription+xml" href="http://note.dim.moe/atom.xml" title="NOTED DIM'ENSIONS"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="wrap"><header><ul class="nav nav-list"><li class="nav-list-item"><b><a href="/" target="_self" class="nav-list-link">NOTED DIM'ENSIONS</a></b></li><li class="nav-list-item"><b><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></b></li><li class="nav-list-item"><b><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></b></li></ul><ul class="nav nav-list"><li class="nav-list-item"><a href="http://blog.dimpurr.com/" target="_blank" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="https://blog.dim.moe/" target="_blank" class="nav-list-link">BLOG.MOE</a></li><li class="nav-list-item"><a href="http://book.dimpurr.com/" target="_blank" class="nav-list-link">BOOK</a></li><li class="nav-list-item"><a href="http://book.dim.moe/" target="_blank" class="nav-list-link">BOOK.MOE</a></li><li class="nav-list-item"><a href="http://note.dimpurr.com/" target="_blank" class="nav-list-link">NOTE</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">将 OptiTrack Motive 导出的 FBX mocap 动作捕捉骨骼动画利用 IK (FK) Retargeting 重映射绑定到 Unreal Metahuman 上</h1><div class="post-info">Mar 13, 2023</div><div class="post-content"><p>拿到 FBX 格式的动捕导出动画，通过 VSCode 暴力打开二进制查看头部信息发现如下字样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Document	Motive Scene</span><br><span class="line">Title		Motive Scene</span><br><span class="line">Subject		Exported from Motive</span><br></pre></td></tr></table></figure>

<p>调查后发现这是一个商业收费动捕软件。</p>
<h3 id="向场景中新增-Metahuman"><a href="#向场景中新增-Metahuman" class="headerlink" title="向场景中新增 Metahuman"></a>向场景中新增 Metahuman</h3><p>新建一个空游戏项目。在左上角 Add 找到 Quixel Bridge 。找到左侧列表的头像按钮，选中 MetaHuman Presets ，找一个合适的模型。</p>
<span id="more"></span>

<p>原则上还应可以在左下角下拉列表中选中低模，但不知道为什么只有高模选项。点击下载。开始下载前一般会要求你再登录一次。随后在下载任务管理器中查看大小，一般在 1-2 GB 之间不等，测试时尽量选一个偏小的不要给自己找罪受。还有个恐怖故事，就是有时候你会下载完了发现这个 metahuman 没有身体，衣服的部分是空的， body 模型只有裸露的手臂和脚踝，还有的就是骨骼不知道为什么没有头和手臂部分的骨骼 …… 目前最正常的是 Amelia 。</p>
<p>下载完成后点击 Add ，人物就被添加到场景了。这时候会提示你要启用一些新插件，全部启用然后重启 UE 生效。</p>
<h3 id="修改-Mocap-FBX-并导入-UE"><a href="#修改-Mocap-FBX-并导入-UE" class="headerlink" title="修改 Mocap FBX 并导入 UE"></a>修改 Mocap FBX 并导入 UE</h3><p>跳过调研过程，直接说结论：Motive 默认导出的 FBX 文件结构有些问题。用 Blender 新建空文件，导入 _body 后即可看到文件结构如下：</p>
<img src="/motive-mocap-ue-metahuman/original-skel-struct.png" class="" title="Metahuman Skeleton Structure">

<p>接下来我们要做的就是把 Motive 导出的 FBX 文件从原有结构：</p>
<img src="/motive-mocap-ue-metahuman/motive-skel-origin.png" class="" width="350" title="Motive Skeleton Orginial">

<p>修改成这个结构：</p>
<img src="/motive-mocap-ue-metahuman/motive-skel-struct.jpg" class="" width="450" title="Motive Skeleton Structure">

<p>具体操作是，按照图标对应层级，</p>
<ol>
<li>将 Cube 按住 Shift 拖进 skeleton 下</li>
<li>把原来的 hips 骨骼节点重命名为 root</li>
</ol>
<p>即可。</p>
<p>该解决方案的参考来源： <a target="_blank" rel="noopener" href="https://forums.unrealengine.com/t/optitrack-motive-to-ue4-how-to-create-root-bone/359610">https://forums.unrealengine.com/t/optitrack-motive-to-ue4-how-to-create-root-bone/359610</a> (<code>i just added mesh to skeleton(just cube) and named the whole skeleton as “root” and it exported/imported just fine</code>)</p>
<p>在 Blender 中再次导出编辑完毕的内容为 FBX ，然后拖进 UE 。</p>
<img src="/motive-mocap-ue-metahuman/import-mocap-edited-fbx.png" class="" width="350" title="Import Edited Mocap FBX">

<p>Skeleton 骨骼选择 metahuman_base_skel 或者不选， Advanced 下面的 Update Skeleton Ref 可选， Use T0 As Fef Pose 按实际情况选你导入的是不是 TPose （无法预料这个行为）。一定要记得勾选底部的导入动画（Animation - Import Animations）。其他默认。</p>
<img src="/motive-mocap-ue-metahuman/importing-edited-fbx.png" class="" title="Importing Edited Mocap FBX">

<p>此时会有一个不短的导入时间，耐心等待完成。</p>
<h3 id="分别新建-metahuman-和-mocap-的-IK-Rig-，进行-FK-链绑定"><a href="#分别新建-metahuman-和-mocap-的-IK-Rig-，进行-FK-链绑定" class="headerlink" title="分别新建 metahuman 和 mocap 的 IK Rig ，进行 FK 链绑定"></a>分别新建 metahuman 和 mocap 的 IK Rig ，进行 FK 链绑定</h3><p>右键新建 - 动画 - IK Rig - IK Rig 。首先选择类似 f_med_nrw_body 字样的身体，完成创建，这里示意命名为 metahuman 。然后再新建一个 IK Rig ，选中刚导入进来的 mocap skeleton mesh ，完成创建，这里示意命名为 mocap 。</p>
<p>然后双击打开两者，可以并排窗口，观察骨骼结构并一一为其赋予名字相同的 FK 节点。</p>
<p>首先在 root 或者 skeleton 上右键 Set Retarget Root 。然后在接下来要设置 FK 节点的端点，右键 New Retarget Chain from Selected Bones 。在弹窗里选中 No Goal 不要设置 IK 解算器，</p>
<img src="/motive-mocap-ue-metahuman/metahuman_fk_struct.png" class="" width="250" title="Metahuman FK Struct">

<h3 id="新建-IK-Retargeting-重绑定器"><a href="#新建-IK-Retargeting-重绑定器" class="headerlink" title="新建 IK Retargeting 重绑定器"></a>新建 IK Retargeting 重绑定器</h3><p>右键新建 - 动画 - IK Rig - IK Rig</p>
<p>（未完待续）</p>
</div></article></div></main><footer><div class="paginator"><a href="/mocap-plan/" class="prev">PREV</a><a href="/metahuman-marvelous/" class="next">NEXT</a></div><div id="vcomments"></div><script>new Valine({
    el: '#vcomments',
    //- appId: 'rfGKuOWT2z4nxbjPVxbS4WXu-MdYXbMMI',
    //- appKey: 'oz2sxWkXcOrVCakcq6W4U25y'
    appId: 'PZ0goebhRPBQicUIJUSA6YAv-gzGzoHsz',
    appKey: 'znA3Ts2FYVedjhPph9XtPocZ',
    serverURLs: 'https://pz0goebh.lc-cn-n1-shared.com'
})</script><div class="copyright"><p>© 2020 - 2023 <a href="http://note.dim.moe">Dimpurr</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>